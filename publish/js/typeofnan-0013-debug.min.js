window.supply=(function(window,document,undefined){var version="1.1.0",dealer="/exec/supply.pl",xhr=null,getLatestPacketInterval=null,lastLength=0,preCached={},boundary="\u0003",fieldDelimiter="\u0001",self={},my={},listeners={},ua=navigator.userAgent.toLowerCase(),toStr=Object.prototype.toString,rootElem=document.documentElement,myID="scr"+(+new Date()),fillMethod=null,scriptElem=document.createElement("script"),_msxml_progid=["Microsoft.XMLHTTP","MSXML2.XMLHTTP.3.0","MSXML3.XMLHTTP","MSXML2.XMLHTTP.6.0"],options={loadjavascript:1,loadstylesheet:2,jsonavailable:4,callback:8,useeval:16,msie:32,compatibleIE:64,debug:128,removescripts:256,localStorage:512,loadimages:1024},settings=0;my.reset=function(){getLatestPacketInterval=null;lastLength=null;cacheDelay=1500;settings=0;if(xhr){xhr.abort()}settings|=options.useeval;settings|=/msie/.test(ua)?options.msie:0;if(settings&options.msie&&ua.match(/msie\D+(\d+(\.\d+)?)/)){if(parseFloat(RegExp.$1)>=8&&"XDomainRequest" in window){settings|=options.compatibleIE}}settings|=(function(){if("localStorage" in window){try{localStorage.setItem("supply","test");if(localStorage.getItem("supply")==="test"){localStorage.removeItem("supply");return options.localStorage}}catch(e){}}return 0}());if("complete" in listeners){listeners.complete=[]}};my.init=(function(){my.reset();xhr=(function(){var req;try{if(settings&options.compatibleIE){req=new XDomainRequest()}else{req=new XMLHttpRequest()}}catch(e){var len=_msxml_progid.length;while(len--){try{req=new ActiveXObject(_msxml_progid[len]);break}catch(e2){}}}finally{return req}}());if(!xhr){throw new Error("Unable to create XMLHttpRequest")}fillMethod=(function(){var method=null;scriptElem.type="text/javascript";scriptElem.textContent="window."+myID+"=1;";rootElem.insertBefore(scriptElem,rootElem.firstChild);if(window[myID]===1){method="textContent";delete window[myID]}else{method="text"}rootElem.removeChild(scriptElem);return method}());if(settings&options.localStorage){preCached=JSON.parse(localStorage.getItem("supplyJS"))||{}}}());self.setDealer=function(path){if(typeof path==="string"){dealer=path}return self};self.files=function(args){var _jsfiles=args.javascript,_cssfiles=args.stylesheet,_imagefiles=args.images,_callback=args.callback,_debug=args.debug,params=[],query="";my.reset();if(_jsfiles&&toStr.call(_jsfiles)==="[object Array]"){settings|=options.loadjavascript}if(_cssfiles&&toStr.call(_cssfiles)==="[object Array]"){settings|=options.loadstylesheet}if(_imagefiles&&toStr.call(_imagefiles)==="[object Array]"){settings|=options.loadimages}if(_debug&&_debug===true){settings|=options.debug}if(_callback&&(typeof _callback==="function"||typeof _callback==="string")){settings|=options.callback}if(settings&options.loadstylesheet){params.push(my.serialize(_cssfiles,"css"))}if(settings&options.loadjavascript){params.push(my.serialize(_jsfiles,"js"))}if(settings&options.loadimages){params.push(my.serialize(_imagefiles,"images"))}if(settings&options.callback){if(typeof _callback==="function"){self.listen("complete",_callback)}else{if(typeof _callback==="string"){if(_callback in window){self.listen("complete",window[_callback])}}}}if(!_debug){query=dealer+"?"+params.join("&");if(settings&options.compatibleIE){xhr.onprogress=function(){my.readyStateHandler(true)};xhr.onload=function(){my.readyStateHandler(true,true)}}else{xhr.onreadystatechange=function(){my.readyStateHandler(false)}}if(query.length<2048){xhr.open("GET",query,true);xhr.send(null)}else{xhr.open("POST",dealer,true);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.send(params.join("&"))}}else{my.attachScript(_jsfiles)}};my.readyStateHandler=function(IE,IEload){if(!(settings&options.msie)||(settings&options.compatibleIE)){if((IE&&getLatestPacketInterval===null)||(xhr.readyState===3&&getLatestPacketInterval===null)){getLatestPacketInterval=window.setInterval(function(){my.getLatestPacket()},25)}}if(xhr.readyState===4||IEload){clearInterval(getLatestPacketInterval);my.getLatestPacket();
if(settings&options.localStorage){localStorage.setItem("supplyJS",JSON.stringify(preCached))}if(listeners.complete&&listeners.complete.length){for(var n=0,len=listeners.complete.length;n<len;n++){listeners.complete[n].apply(window)}}}};my.getLatestPacket=function(){var length=xhr.responseText.length,packet=xhr.responseText.substring(lastLength,length);my.processPacket(packet);lastLength=length};my.processPacket=function(packet){if(packet.length<1){return}var startPos=packet.indexOf(boundary),endPos=-1;if(startPos>-1){if(my.currentStream){endPos=startPos;startPos=-1}else{endPos=packet.indexOf(boundary,startPos+boundary.length)}}if(!my.currentStream){my.currentStream="";if(startPos>-1){if(endPos>-1){var payload=packet.substring(startPos,endPos);my.currentStream=my.currentStream+payload;packet=packet.slice(endPos);my.processPayload();my.processPacket(packet)}else{my.currentStream+=packet.substr(startPos)}}}else{if(endPos>-1){var chunk=packet.substring(0,endPos);my.currentStream+=chunk;packet=packet.slice(endPos);my.processPayload();my.processPacket(packet)}else{my.currentStream+=packet}}};my.processPayload=function(){my.currentStream=my.currentStream.replace(boundary,"");var pieces=my.currentStream.split(fieldDelimiter),mime=pieces[0],filename=pieces[1],mtime=pieces[2],payload=pieces[3];if(typeof listeners[mime]!=="undefined"){for(var n=0,len=listeners[mime].length;n<len;n++){listeners[mime][n].call(my,payload,filename,mtime)}}delete my.currentStream};my.attachScript=function(container){var scr=document.createElement("script"),head=document.getElementsByTagName("head")[0],isArr=toStr.call(container)==="[object Array]",path=isArr?container.shift():container;if(!path){if(listeners.complete&&listeners.complete.length){for(var n=0,len=listeners.complete.length;n<len;n++){listeners.complete[n].apply(window)}}return}scr.src="/js/"+path;scr.type="text/javascript";scr.onload=scr.onreadystatechange=function(){if(scr.readyState){if(scr.readyState==="complete"||scr.readyState==="loaded"){scr.onreadystatechange=null;isArr&&my.attachScript(container)}}else{if("console" in window){console.log(scr.src," attached")}isArr&&my.attachScript(container)}};head.insertBefore(scr,head.firstChild)};my.serialize=function(arr,name){var ret=[],len=arr.length,hlen,cached_obj,i;if(toStr.call(arr)==="[object Array]"&&typeof name==="string"){if(settings&options.localStorage){for(i=0;i<len;i++){cached_obj=(arr[i] in preCached)?JSON.parse(preCached[arr[i]]):"0";ret.push([name,"=",arr[i],"~",cached_obj.modified].join(""));if(cached_obj&&cached_obj.mime==="text/css"){if(typeof listeners[cached_obj.mime]!=="undefined"){for(var n=0,hlen=listeners[cached_obj.mime].length;n<hlen;n++){listeners[cached_obj.mime][n].call(my,cached_obj.src,cached_obj.filename,null)}}}}}else{for(i=0;i<len;i++){ret.push([name,"=",arr[i]].join(""))}}return ret.length?ret.join("&"):undefined}return undefined};my.removeDuplicateNode=function(head,name){var nodes=document.getElementsByTagName("style"),len=nodes.length;while(len--){if(nodes[len].getAttribute("name")===name){head.removeChild(nodes[len])}}};self.listen=function(mime,cb){if(typeof listeners[mime]==="undefined"){listeners[mime]=[]}if(typeof cb==="function"){listeners[mime].push(cb)}};(function(){self.listen("text/javascript",function(payload,filename,mtime){if(settings&options.localStorage){if(payload==="cached"){payload=JSON.parse(preCached[filename]).src}else{preCached[filename]=JSON.stringify({modified:mtime,src:payload,mime:"text/javascript",filename:filename})}}try{if(settings&options.useeval){eval(payload)}else{var head=document.getElementsByTagName("head")[0]||document.documentElement,nscr=document.createElement("script");nscr.type="text/javascript";nscr[fillMethod]=payload;nscr.setAttribute("name",filename);head.insertBefore(nscr,head.firstChild);if(settings&options.removescripts){head.removeChild(nscr)}}}catch(err){if("console" in window){console.error(filename,": Exception. Details -> ",err)}}});self.listen("text/css",function(payload,filename,mtime){if(settings&options.localStorage&&filename&&mtime){if(payload==="cached"){payload=JSON.parse(preCached[filename]).src
}else{preCached[filename]=JSON.stringify({modified:mtime,src:payload,mime:"text/css",filename:filename})}}var head=document.getElementsByTagName("head")[0]||document.documentElement,nstyle=document.createElement("style");nstyle.type="text/css";nstyle[fillMethod]=payload;nstyle.setAttribute("name",filename);my.removeDuplicateNode(head,filename);head.insertBefore(nstyle,head.firstChild);if(settings&options.removescripts){head.removeChild(nstyle)}})}());return(self)}(window,window.document));